//==============================================================================
/**
 * @file	we_311.s
 * @brief	ウェザーボール			311
 * @author	goto
 * @date	2005.07.13(水)
 *
 * ここに色々な解説等を書いてもよい
 *
 */
//==============================================================================
	
	.text
	
	.include	"west.h"

	.global		WEST_WHEZAABOORU
	
// =============================================================================
//
//
//	■ウェザーボール			311
//
//
// =============================================================================
WEST_WHEZAABOORU:
	
	LOAD_PARTICLE_DROP	0,W_311_SPA
	
	FUNC_CALL		WEST_SP_WE_SSP_POKE_SCALE_UPDOWN, 8, (WE_TOOL_M1 | WE_TOOL_SSP), 100, 100, 100, 140, 100, 1, (5 << 16) | 5
	
	SE_L			SEQ_SE_DP_W207
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL1,	EMTFUNC_ATTACK_POS
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL2,	EMTFUNC_ATTACK_POS

	WAIT			25
	SE_C			SEQ_SE_DP_W197
	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 0, 0, 8, WE_PAL_WHITE,
	WAIT_FLAG
	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 0, 8, 0, WE_PAL_WHITE,
	WAIT_FLAG
	WAIT			10
	
	///< 天候分岐	通常	雨		砂		晴		霰
	TENKI_JP		TYPE_1,	TYPE_3,	TYPE_5,	TYPE_2,	TYPE_4,	
	
	SEQEND

#define W311_HIT_WAIT	(20)		///< ヒットブルブルまで
#define W311_PAL_PARAM	(10)		///< フェードの濃さ

///< ノーマル
TYPE_1:

	SE_REPEAT_R		SEQ_SE_DP_W172,2,7
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL3,	EMTFUNC_DEFENCE_POS
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL4,	EMTFUNC_DEFENCE_POS
	
	ADD_PARTICLE 	0,W_311_311_BALL_BURN,		EMTFUNC_DEFENCE_POS

	SEPLAY_PAN		SEQ_SE_DP_W152, WAZA_SE_PAN_AT

	WAIT			W311_HIT_WAIT
	FUNC_CALL		WEST_SP_WT_SHAKE, 5, SHAKE_M_X, 0, SHAKE_M_WAIT, SHAKE_M_NUM,  WE_TOOL_E1 | WE_TOOL_SSP,

	WAIT_PARTICLE
	EXIT_PARTICLE	0,
	
	SEQEND

///< 晴れ
TYPE_2:

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, 0, W311_PAL_PARAM, WE_PAL_RED_BROWN,
	WAIT_FLAG

	SE_REPEAT_R		SEQ_SE_DP_W172,2,7
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL3A,	EMTFUNC_DEFENCE_POS
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL4A,	EMTFUNC_DEFENCE_POS
	
	ADD_PARTICLE 	0,W_311_311_BALL_BURN,		EMTFUNC_DEFENCE_POS

	SEPLAY_PAN		SEQ_SE_DP_W152, WAZA_SE_PAN_AT
	
	WAIT			W311_HIT_WAIT
	FUNC_CALL		WEST_SP_WT_SHAKE, 5, SHAKE_M_X, 0, SHAKE_M_WAIT, SHAKE_M_NUM,  WE_TOOL_E1 | WE_TOOL_SSP,

	WAIT_PARTICLE
	EXIT_PARTICLE	0,

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, W311_PAL_PARAM, 0, WE_PAL_RED_BROWN,
	WAIT_FLAG

	SEQEND

///< 雨
TYPE_3:

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, 0, W311_PAL_PARAM, WE_PAL_BLUE,
	WAIT_FLAG

	SE_REPEAT_R		SEQ_SE_DP_W172,2,7
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL3B,	EMTFUNC_DEFENCE_POS
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL4B,	EMTFUNC_DEFENCE_POS
	
	ADD_PARTICLE 	0,W_311_311_BALL_BURN,		EMTFUNC_DEFENCE_POS

	SEPLAY_PAN		SEQ_SE_DP_W152, WAZA_SE_PAN_AT
	
	WAIT			W311_HIT_WAIT
	FUNC_CALL		WEST_SP_WT_SHAKE, 5, SHAKE_M_X, 0, SHAKE_M_WAIT, SHAKE_M_NUM,  WE_TOOL_E1 | WE_TOOL_SSP,

	WAIT_PARTICLE
	EXIT_PARTICLE	0,

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, W311_PAL_PARAM, 0, WE_PAL_BLUE,
	WAIT_FLAG
	
	SEQEND
	
///< あられ
TYPE_4:

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, 0, W311_PAL_PARAM, WE_PAL_GRAY,
	WAIT_FLAG
	
	SE_REPEAT_R		SEQ_SE_DP_W172,2,7
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL3C,	EMTFUNC_DEFENCE_POS
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL4C,	EMTFUNC_DEFENCE_POS
	
	ADD_PARTICLE 	0,W_311_311_BALL_BURN,		EMTFUNC_DEFENCE_POS

	SEPLAY_PAN		SEQ_SE_DP_W152, WAZA_SE_PAN_AT
	
	WAIT			W311_HIT_WAIT
	FUNC_CALL		WEST_SP_WT_SHAKE, 5, SHAKE_M_X, 0, SHAKE_M_WAIT, SHAKE_M_NUM,  WE_TOOL_E1 | WE_TOOL_SSP,

	WAIT_PARTICLE
	EXIT_PARTICLE	0,

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, W311_PAL_PARAM, 0, WE_PAL_GRAY,
	WAIT_FLAG
		
	SEQEND

///< すなあらし
TYPE_5:

	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, 0, W311_PAL_PARAM, WE_PAL_YELLOW_2,
	WAIT_FLAG
	
	SE_REPEAT_R		SEQ_SE_DP_W172,2,7
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL3D,	EMTFUNC_DEFENCE_POS
	ADD_PARTICLE 	0,W_311_311_WEATHER_BALL4D,	EMTFUNC_DEFENCE_POS
	
	ADD_PARTICLE 	0,W_311_311_BALL_BURN,		EMTFUNC_DEFENCE_POS

	SEPLAY_PAN		SEQ_SE_DP_W152, WAZA_SE_PAN_AT
	
	WAIT			W311_HIT_WAIT
	FUNC_CALL		WEST_SP_WT_SHAKE, 5, SHAKE_M_X, 0, SHAKE_M_WAIT, SHAKE_M_NUM,  WE_TOOL_E1 | WE_TOOL_SSP,

	WAIT_PARTICLE
	EXIT_PARTICLE	0,
	
	FUNC_CALL		WEST_SP_WE_HAIKEI_PAL_FADE, 5, 0, 1, W311_PAL_PARAM, 0, WE_PAL_YELLOW_2,
	WAIT_FLAG
	
	SEQEND
